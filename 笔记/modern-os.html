<!DOCTYPE html>
<html>
  <head>
    <meta name="description" content="欢迎访问 Harttle 的个人主页，这里记录了 harttle 关于计算机技术的文章、个人信息与相册，以及有用的资源分享和下载。">
    <meta name="keywords" content="Linux Web 计算机 开发 编程">
    <meta name="author" content="harttle">      
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Modern Operating Systems - Harttle Land</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- style -->
    <!-- Bootstrap -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    
    <!-- font-awesome -->
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
      
    <!-- Custom styles  -->
    <link href="/assets/css/sticky-footer-navbar.css" rel="stylesheet">
    <link href="/assets/css/main.css" rel="stylesheet">

    <!-- Icon -->
    <link rel="shortcut icon" href="/assets/img/favicon.png"> 

    
    
<style>
.headerbar{
  background: rgba(255, 255, 255, 0.75);
  box-shadow: inset 0 -1px 0 white, 0 1px 5px rgba(0,0,0,.3);
}
.headerbar .page-header{
  border-bottom: 0;
  margin-bottom: 0px;
  margin-top: 0px;
}
#page-content{
  margin-top: 20px;
  margin-bottom: 15px;
}
</style>


<link rel="stylesheet" href="/assets/css/markdown.css">
<link rel="stylesheet" href="/assets/css/syntax.css">
<style>
  /* By default it's not affixed in mobile views, so undo that */
  .sidebar.affix {
    position: static;
  }
  
  /* First level of nav */
  .sidenav {
    margin-top: 20px;
    margin-bottom: 20px; 
    padding-top:    10px;
    padding-bottom: 10px;
    text-shadow: 0 1px 0 #fff;
    background-color: #f5f5f5;
    border-radius: 5px;
  }
  
  /* All levels of nav */
  .sidebar .nav > li > a {
    display: block;
    /*color: #6c6c6c;*/
    padding: 5px 20px;
    color: #428bca;
    text-decoration: none;
  }
  .sidebar .nav > li > a:hover,
  .sidebar .nav > li > a:focus {
    text-decoration: none;
    background-color: #e5e5e5;
    border-right: 1px solid #d5d5d5;
  }
  
  .sidebar .nav > .active > a,
  .sidebar .nav > .active:hover > a,
  .sidebar .nav > .active:focus > a {
    font-weight: bold;
    /*color: #555;
    background-color: transparent;*/
    color: white;
    background: #428bca;
    text-shadow: 0 1px 0 rgba(0,0,0,.15);
    -webkit-box-shadow: inset 1px 0 0 rgba(0,0,0,.1), inset -1px 0 0 rgba(0,0,0,.1);
       -moz-box-shadow: inset 1px 0 0 rgba(0,0,0,.1), inset -1px 0 0 rgba(0,0,0,.1);
            box-shadow: inset 1px 0 0 rgba(0,0,0,.1), inset -1px 0 0 rgba(0,0,0,.1);
    border-right: 1px solid #009;
  }
  
  /* Nav: second level (shown on .active) */
  .sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    margin-bottom: 8px;
  }
  .sidebar .nav .nav > li > a {
    padding-top:    3px;
    padding-bottom: 3px;
    padding-left: 30px;
    font-size: 90%;
  }
  .sidebar .nav .nav .nav > li > a {
    padding-left: 40px;
  }
  .sidebar .nav .nav .nav .nav > li > a {
    padding-left: 50px;
  }
  .sidebar .nav .nav .nav .nav .nav > li > a {
    padding-left: 60px;
  }
  .sidebar .nav .nav .nav .nav .nav .nav> li > a {
    padding-left: 70px;
  }  
  
  /* Show and affix the side nav when space allows it */
  @media (min-width: 992px) {
    .sidebar .nav > .active > ul {
      display: block;
    }
    /* Widen the fixed sidebar */
    .sidebar.affix,
    .sidebar.affix-top,
    .sidebar.affix-bottom {
      width: 213px;
    }
    .sidebar.affix {
      position: fixed; /* Undo the static from mobile first approach */
      top: 90px;
    }
    .sidebar.affix-bottom {
      position: absolute; /* Undo the static from mobile first approach */
    }
    .sidebar.affix-bottom .sidenav,
    .sidebar.affix .sidenav {
      margin-top: 0;
      margin-bottom: 0;
    }
  }
  @media (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .sidebar.affix-bottom,
    .sidebar.affix-top,
    .sidebar.affix {
      width: 263px;
    }
  } 
    
  .MathJax *{
    color: black!important;  
  }
</style>


    <!-- style -->
  </head>
  
  <body>
  
  <!-- content -->  
    <!-- Wrap all page content here -->
    <div id="wrap">

      <!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-inverse navbar-fixed-top global-nav">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Harttle Land</a>
          </div>
          <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
              <li id="blog"><a href="/category/blog.html">博客</a></li>
              <li id="album"><a href="/category/album.html">相册</a></li>
              <li id="about"><a href="/about.html">关于</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">链接 <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="//harttle.duapp.com" target="_blank">God Notes</a></li>
                  <li><a href="//www.pku.edu.cn/" target="_blank">北京大学</a></li>
                </ul>
              </li>
            </ul>
	    <ul class="nav navbar-nav pull-right">	 
	      <li>
		<a href="//github.com/harttle/harttle.github.io" target="_blank">
		  <i class="fa fa-github fa-lg"></i> GitHub
		</a>
	      </li>
	      <li>
		<a href="/feed.xml" target="_blank">
		  <i class="fa fa-rss-square fa-lg"></i> RSS
		</a>
	      </li>
	    </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>

      <!-- Begin page content -->
      <div id="main-content">
	
	
<div class="headerbar">
  <div class="page-header container">
    <h1>
      Modern Operating Systems <small></small>
    </h1>
    <div>
      
      <span class="label label-info pull-left" style="margin-right: 10px;"><span class="glyphicon glyphicon-folder-open"></span> 笔记</span>
      
      
      <span class="label label-success pull-left hidden-xs" style="margin-right: 10px;"><span class="glyphicon glyphicon-tag"></span> 读书笔记</span>
      
      <span class="label label-success pull-left hidden-xs" style="margin-right: 10px;"><span class="glyphicon glyphicon-tag"></span> 操作系统</span>
      
      <a class="pull-right label label-warning" href="/category/blog.html" style="margin-left: 10px;">
          返回列表 <span class="glyphicon glyphicon-hand-left"></span>
      </a>
      <span class="pull-right label label-default hidden-xs">
          <span class="glyphicon glyphicon-time"></span> 2014年01月06日
      </span>
    </div>
  </div>
</div>

<div class="container">
 
  <div id="page-content">
    
    
<div class="row post-display">
    <div class="col-md-3 left" >
      <div class="sidebar"></div>
    </div>
    <div class="col-md-9 right md">
      <h1>Introduction</h1>
<h2>What is OS</h2>
<ol>
<li><strong>extendes machines</strong> : providing programmers(and programs) a clean abstract set of resources instead of the messy hardware</li>
<li><strong>resource manager</strong> : managing hardware resources</li>
</ol>
<h2>History of OS</h2>
<p>The first digital computer was designed by Charles Babbage. Ada Lovelace was the first programmer(hired by Babbage).</p>
<h3>1st Generation Vacuum Tubes</h3>
<ul>
<li>The first functioning digital computer, by John Atanasoff and Clifford Berry, Iowa State University.</li>
<li>Z3, Konrad Zuse, Berlin.</li>
<li>Colossus, a group at Bletchey Park, England</li>
<li>Mark I, Howard Aiken, Harvard</li>
<li>ENIAC, William Mauchley and J. Presper Eckert, University of Pennsylvania</li>
</ul>
<h3>2nd Generation Transistors and Batch System</h3>
<p><strong>batch system</strong> </p>
<ol>
<li>Programmers bring cards to IBM 1401</li>
<li>1401 read batch of jobs onto tape</li>
<li>Operator carries input tape to IBM 7094</li>
<li>7094 does computing</li>
<li>Operator carries output tape to 1401</li>
<li>1401 prints output</li>
</ol>
<h3>3rd Generation ICs and Multiprogramming</h3>
<p><strong>IBM System/360</strong> </p>
<p>A series of software-compatible machines differed only in price and performance.</p>
<p>360 was the first major computer line to use <strong>ICs(Integrated Circuits)</strong>.</p>
<p><strong>OS/360</strong> had to work on all models, the result was an enormous and complex OS, each release fixed some bugs and introduced new ones.</p>
<p><strong>multiprogramming</strong> </p>
<p>Partition memory into several pieces, with a different job in each partition. While one job was waiting for I/O, another job could be using the CPU.</p>
<p><strong>spooling</strong> </p>
<p>Simultaneous Peripheral Operation On Line, OS read jobs from cards onto the disk as soon as they were brought to the computer room, whenever a running job finished, the operating system could load a new job from the disk and run it.</p>
<p><strong>timesharing</strong></p>
<p>Proveding quick response time. The 1st general-purpose timesharing system, **CTSS(Compatible Time Sharing System) was developed at MIT.</p>
<p><strong>MULTICS(MULTiplexed Information and Computing Service)</strong></p>
<p>Developed by MIT, Bell Labs, and General Electric, MULTICS supports handreds of uses on a machine only slightly powerful than an Intel 386-based PC.</p>
<p><strong>minicomputer</strong></p>
<p>DEC PDP-1(1961) and other PDPs(all incompatible)</p>
<p><strong>UNIX</strong></p>
<p>Developed by Ken Thompson(based on PDP-7  minicomputer). There are 2 major versions: </p>
<p><strong>System V</strong>(from AT&amp;T) and <strong>BSD</strong>(Berkeley Software Distribution)</p>
<p>1987, <strong>MINIX</strong> was released for educational purposes.</p>
<h3>4th Generation Personal Computers</h3>
<p>With the development of <strong>LSI</strong>(Large Scale Integration) circuits, <strong>microcomputers</strong> appears.</p>
<p> Kildall developed <strong>CP/M</strong>(Control Program for Microcomputers, disk-based OS), which later supports 8080, Zilog Z80, and other CPU chips.</p>
<p>Bill Gates offered <strong>DOS</strong>(Disk Operating System, which renamed to MS-DOS later) to IBM.</p>
<p>Engelbart invented the <strong>GUI</strong>(Graphical User Interface), which was adopted by Xerox PARC.</p>
<p><strong>Apple</strong></p>
<p>Steve Jobs visited PARC and embarked on building an Apple with a GUI.</p>
<p><strong>Windows</strong></p>
<p>Microsoft released Windows 95, Windows 98(with 16-bit Intel CPU), Windows NT(New Technology, 32-bit), Windows Me(Millennium edition), Windows 2000(1999,renamed from Windows NT5), and Windows XP(2001).</p>
<p><strong>UNIX</strong></p>
<p>FreeBSD, originating from BSD project at Berkeley. X Window System(X11), MIT.</p>
<h2>OS ZOO</h2>
<p><strong>Mainframe OS</strong></p>
<p>Oriented toward process many jobs at once, most of which need prodigious amounts of I/O.</p>
<p><strong>Server OS</strong></p>
<p>Serve multiple users at once over a network and allow the users to share hardware and software resources.</p>
<p><strong>Mutiprocessor OS</strong></p>
<p>Special features for communication, connectivity, and consistency.</p>
<p><strong>Personal Computer OS</strong></p>
<p>Provide good surport to a single user.</p>
<p><strong>Handheld Computer OS</strong></p>
<p><strong>PDA</strong>(Personal Digital Assistant) and mobiles.</p>
<p><strong>Embedded OS</strong></p>
<p>Donot accept user-installed software.</p>
<p><strong>Sensor Node OS</strong></p>
<p>Tiny computers that communicate with each other and with a base station using wireless communication.</p>
<p><strong>Real-Time OS</strong></p>
<p><strong>hard real-time</strong> the action absolutely must occur at a certain moment.</p>
<p><strong>soft real-time</strong> missing an occasional deadline is acceptable and does not cause any permanent damage.</p>
<p><strong>Smart Card OS</strong></p>
<p>Some are Java-oriented. The ROM holds an interpreter for the JVM.<br>Resource management and protection.</p>
<h2>OS Structure</h2>
<h3>Monolithic Systems</h3>
<p>Basic sturctures</p>
<ol>
<li>A main program that invokes requested service procedure.</li>
<li>A set of service procedures that carry out the system calls.</li>
<li>A set of utility procedures that help the service procedures.</li>
</ol>
<h3>Layered Systems</h3>
<p><strong>THE</strong> system built by E. W. Dijkstra.</p>
<table>
<thead>
<tr>
<th style="text-align:center">layer</th>
<th style="text-align:left">function</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:left">The operator</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:left">User programs</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:left">I/O management</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:left">Operator-process communication</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:left">Memory and drum management</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:left">Processor allocation and multiprogramming</td>
</tr>
</tbody>
</table>
<p><strong>MULTICS</strong> was described as having a series of concentric rings, with the inner ones being more privileged than the outer ones.</p>
<blockquote>
<p>The advantage is that it can be easily extended to structure user subsystems.</p>
</blockquote>
<h3>Microkernels</h3>
<p>Achieve high reliability by spilitting the OS into small, well-defined modules, only one of which(the microkernel) runs in kernel mode.</p>
<p>An idea related to having a minimal kernal is to put the <strong>mechanism</strong> for doing something in the kernel but not <strong>policy</strong>.</p>
<blockquote>
<p>A few of better-known microkernels: Integrity, K42, Symbian, and MINIX 3.</p>
</blockquote>
<h3>Client-Server Model</h3>
<p>A slight variantion of the microkernel idea is to distinguish 2 classes of processes, the <strong>servers</strong>(providing services), and the <strong>clients</strong>(use these services).</p>
<h3>Virtual Machines</h3>
<h4>Type 1 hypervisor</h4>
<p>Also known as <strong>virtual machine monitor</strong>, runs upon th e hardware.</p>
<p><strong>CP/CMS</strong> , later renamed VM/370 is a timesharing system provedes </p>
<ol>
<li>multiprogramming </li>
<li>extended machine with a more convenient interface than the bare hardware</li>
</ol>
<p><strong>CMS</strong> (Conversational Monitor System), a single-user, interactive processing OS.</p>
<h4>Type 2 hypervisor</h4>
<p>Runs upon the Host OS, like other applications.</p>
<h3>Exokernels</h3>
<p>Rather than cloning the actual machine, another strategy is pratitioning it, giving each user a subset of the resources.</p>
<p>At the bottom layer, running in kernel mode, is a program called the <strong>exokernal</strong>.</p>
<h1>Processes and Threads</h1>
<h2>Processes</h2>
<p><strong>pseudoparallelism</strong></p>
<p>The illusion of parallelism while CPU is switching from process to process quickly.</p>
<h3>The Process Model</h3>
<p><strong>process</strong> is an instance of an executing program, is the activity of a program.</p>
<blockquote>
<p>If a program is running twice, it counts as two processes.</p>
</blockquote>
<h3>Process Creation</h3>
<p>When processes are created</p>
<ol>
<li>System init</li>
<li>Process creation system call by a running process</li>
<li>A user request to create a new process.</li>
<li>Init of a batch job.</li>
</ol>
<p><strong>fork</strong></p>
<p>In Unix, this call creates an exact clone of the calling process. <code>execve</code> is another syscall used to change its memory image and run a new program.</p>
<blockquote>
<p>This separation allows the child to manipulate its file descriptors after <code>fork</code> but before the <code>execve</code> in order to accomplish redirections.</p>
</blockquote>
<p><strong>CreateProcess</strong></p>
<p>In Windows, this call handles both process creation and loading with 10 parameters.</p>
<blockquote>
<p>It&#39;s possible for a newly created process to share resources such as open files.</p>
</blockquote>
<h3>Process Termination</h3>
<p>When processes terminate</p>
<ol>
<li>Normal exit (voluntary)</li>
<li>Error exit (voluntary)</li>
<li>Fatal error (involuntary)</li>
<li>Killed by another process (involuntary)</li>
</ol>
<p>Voluntary termination: <code>exit</code> in UNIX and <code>ExitProcess</code> in Windows. Kill someother process: <code>kill</code> in UNIX and <code>TerminateProcess</code> in Windows.</p>
<h3>Process Hierarchies</h3>
<p>In UNIX, a process and all its children and further descendants form a process group. User signals are sends to all members in the group.</p>
<blockquote>
<p><code>init</code> is the first process created in boottime. Thus all processes in the whole system belong to a single tree with <code>init</code> as the root.</p>
</blockquote>
<p>Windows has no concept of process hierarchy, despite that a handle(a special token used to control the child) is returnd when creating a new process.</p>
<h3>Process States</h3>
<ol>
<li>Running (actually using the CPU)</li>
<li>Ready (runnable; temporariy stopped to let another process run)</li>
<li>Blocked (unable to run util some external event happens)</li>
</ol>
<h3>Implementation of Processes</h3>
<p>The OS maintains a <strong>process table</strong> , with one entry ( <strong>process control block</strong> ) per process. Each entry contains program counter, stack pointer, memory allocation, status of open files, scheduling information registers, and everything need to save when swapped out.</p>
<p>Interrupt routine</p>
<ol>
<li>Hardware stacks program counter, etc</li>
<li>Hardware loads new program counter from interrupt vector</li>
<li>Assembly language procedure saves registers.</li>
<li>Assembly language procudure sets up new stack.</li>
<li>C interrupt service runs (typically reads and buffers input).</li>
<li>Scheduler decides which process is to run next.</li>
<li>C procedure returns to the assembly code.</li>
<li>Assembly language procedure starts up new current processes.</li>
</ol>
<h3>Modeling Multiprogramming</h3>
<p>Suppose p is the fraction of I/O time for a process. n is current count of processes. Then</p>
<p><span class="mathjax">\(CPU~utilization = 1 - p^n\)</span></p>
<p>where n is called the <strong>degree of multiprogramming</strong> .</p>
<h2>Threads</h2>
<h3>Thread Usage</h3>
<ol>
<li>Multiple activities going on at once with the ability to share an address space</li>
<li>Lighter weight than processes, easy to create and destroy.</li>
<li>Overlap activities with substantial I/O to speeding up the application.</li>
<li>Useful on systems with multiple CPUs.</li>
</ol>
<p>Three ways to construct a server</p>
<ol>
<li>Thread. Parallelism, blocking system calls.</li>
<li>Single-threaded process. No parallelism, blocking system calls.</li>
<li>Finite-state machine. Parallelism, nonblocking system calles, use interrupts to simulate thread.</li>
</ol>
<h3>Classical Thread Model</h3>
<p>Processes are used to group resources together; threads are the entities scheduled for execution on the CPU. There are no protection betwwen threads because (1) it&#39;s impossible, and (2) it should not be nessessary.</p>
<p>While threads share one memory space, it takes fewer space to maintain a thread, including Program Counter, Registers, Stack and State.</p>
<h3>POSIX Threads</h3>
<p><code>Pthread_create</code>: create a new thread.<br><code>Pthread_exit</code>: terminate the calling thread.<br><code>Pthread_join</code>: wait for a specific thread to exit.<br><code>Pthread_yield</code>: release the CPU.<br><code>Pthread_attr_init</code>: create and initialize a thread&#39;s attribute structure.<br><code>Pthread_attr_destroy</code>: remove a thread&#39;s attribute structure.</p>
<h3>Implementing Threads in User Space</h3>
<p>Advantages</p>
<ol>
<li>useful on an OS that doesn&#39;t support threads</li>
<li>switching is faster than trapping to the kernal</li>
<li>allow process have its own scheduling algorithm</li>
</ol>
<p>Problems</p>
<ol>
<li><p>Implementation of blocking sys-calls. </p>
<p> These calles intended to block the process (all threads in it) since the kernal know nothing about threads. This problem could be solved by adding <strong>wrappers</strong> to all blocking sys-calls.</p>
</li>
<li><p>Page faults.</p>
<p> The same as above.</p>
</li>
<li>A running thread never voluntarily gives up the CPU since no clock interrupts in user space.</li>
<li>Substantial sys-calles are needed generally in threads. It&#39;s hardly any more work for the kernel to switch threads.</li>
</ol>
<h3>Implementing Threads in the Kernel</h3>
<blockquote>
<p>Due to the relatively greater cost of creating and destroying threads in the kernel, some systems take an environmentally correct approach and recycle their threads.</p>
</blockquote>
<p>Problems</p>
<ol>
<li>When a multithreades process forks</li>
<li>Signals sent to a multithread process</li>
</ol>
<h3>Hybrid Implementations</h3>
<p>Programmers can determine how many kernel threads to use and how many user-level threads to multiplex on each one.</p>
<h3>Scheduler Activations</h3>
<p>The kernel notifies the process&#39; run-time system to switch thread, thus avoiding unnecessary transitions between user and kernel space.</p>
<blockquote>
<p>This implementation violates the structure inherent in any layered system.</p>
</blockquote>
<h3>Pop-Up Threads</h3>
<p>On arrival of a message, the system creates a new thread to handle it. Since a pop-up thread has no history, it&#39;s quicker to create than swap.</p>
<h3>Making Single-Threaded Code Multithread</h3>
<p>Problems should be solved</p>
<ol>
<li><p>global variables</p>
<p> Private global variables. A new library to create, set, read these variables is needed.</p>
</li>
<li><p>many library procedures are not reentrant</p>
<p> A jacket for each of these procedures is needed.</p>
</li>
<li>signals</li>
<li><p>stack management</p>
<p> overflows could not be awared.</p>
</li>
</ol>
<h2>Interprocess Communication</h2>
<p><strong>race conditions</strong></p>
<p>Two or more processes are reading or writing some shared data and the final result depends on who runs precisely when.</p>
<h3>Critical Regions</h3>
<p><strong>mutual exclusion</strong></p>
<p>Prohibit more than one process from reading and writing the shared data at the same time.</p>
<p><strong>critical region</strong></p>
<p>Also called <strong>critical section</strong> , the part of the program where the shared memory is accessed.</p>
<p>Conditions to a good solution</p>
<ol>
<li>No two processes may be simultaneously inside their critical regions</li>
<li>No assumptions may be made about speeds or the number of CPUs</li>
<li>No process running outside its critical region may block other processes</li>
<li>No process should have to wait forever to enter its critical region</li>
</ol>
<h3>Mutual Exclusion with Busy Waiting</h3>
<h4>Disable Interrupts</h4>
<p>Problems</p>
<ol>
<li>It&#39;s unwise to give user processes the power to turn off interrupts.</li>
<li>It&#39;s convenient for the kernel itself to disable interrupts for a few instructions, when race conditions could occur.</li>
</ol>
<h4>Lock Variables</h4>
<p>This would not take place without atom operations.</p>
<h4>Strict Alternation</h4>
<pre><code><span class="comment">//Process 1</span>
<span class="keyword">while</span>(TRUE){
    <span class="keyword">while</span> (turn != <span class="number">0</span>);
    critical_region();
    turn = <span class="number">1</span>;
    noncritical_region();
}

<span class="comment">//Process 2</span>
<span class="keyword">while</span>(TRUE){
    <span class="keyword">while</span>(turn != <span class="number">1</span>);
    critical_region();
    turn = <span class="number">0</span>;
    noncritical_regino();
}
</code></pre><p>Problem: neither of them could run twice in a row, which violates condition 3.</p>
<blockquote>
<p>Continuously testing a variable until some value apperas is called <strong>busy waiting</strong> , a lock that uses busy waiting is called a <strong>spin lock</strong> .</p>
</blockquote>
<h4>Peterson&#39;s Solution</h4>
<p>Busy waiting lock variables.</p>
<pre><code><span class="preprocessor">#define FALSE 0</span>
<span class="preprocessor">#define TRUE 1</span>
<span class="preprocessor">#define N 2</span>

<span class="keyword">int</span> turn;
<span class="keyword">int</span> interested[N];

<span class="keyword">void</span> enter_region(<span class="keyword">int</span> process)
{
    <span class="keyword">int</span> other = <span class="number">1</span> - process;
    interested[process] = TRUE;
    turn = process;
    <span class="keyword">while</span> (turn == process &amp;&amp; interested[other] == TRUE);
}

<span class="keyword">void</span> leave_region(<span class="keyword">int</span> process)
{
    interested[process] = FALSE;
}
</code></pre><h4>TSL Instruction</h4>
<pre><code>TSL RX, LOCK
</code></pre><p>Test and lock lock instruction reads the content of the memory word <code>lock</code> into register <code>RX</code> and then stores a nonzero value at the memory address <code>lock</code>.</p>
<blockquote>
<p>It&#39;s guaranteed by the hardware that the read and set operations are indivisible.</p>
</blockquote>
<pre><code>enter_region:
    TSL REGISTER, LOCK
    JNE REGISTER, #0, enter_region
    RET     &#39;return

leave_region:
    MOVE LOCK, #0
    RET
</code></pre><p>An alternative instruction to <code>TSL</code> is <code>XCHG</code>. The implementations are similiar.</p>
<h3>Sleep and Wakeup</h3>
<p>Problems in busy waiting:</p>
<ol>
<li>wasting CPU time</li>
<li>process with higer priority will keep busy waiting while lower priority process never run</li>
</ol>
<h4>The Product-Consumer Problem</h4>
<pre><code>Producer loop:
    <span class="keyword">if</span> count == N:
        sleep
    <span class="keyword">else</span>:
        produce one
    <span class="keyword">if</span> count == <span class="number">1</span>:
        wakeup consumer

Consumer loop:
    <span class="keyword">if</span> count == <span class="number">0</span>:
        sleep
    <span class="keyword">else</span>:
        consume one
    <span class="keyword">if</span> count == N-<span class="number">1</span>
        wakeup producer
</code></pre><p>Since <code>count</code> is unconstrained, race condition could occur. When consumer is about to sleep, wakeup signal from producer is lost, causing both of them sleeping.</p>
<h4>Semaphores</h4>
<p>Semaphores are used to buffer signals, keep them from losing. Value 0 indicating that no wakeups were saved; positive value if some wakeups were pending.</p>
<p><code>down</code>(Proberen, try in Dutch) operation: checking the value and cosume one or sleep to wait one.<br><code>up</code>(Verhogen, raise in Dutch) operation: produce one, if someone&#39;s waiting, wake him.</p>
<h3>Mutexes</h3>
<p><strong>mutex</strong> </p>
<p>A kind of semaphore, a variable that can be in 1 of 2 states: unlocked or locked, used when the semaphore&#39;s ability to count is not needed.</p>
<h3>Monitors</h3>
<p>When several mutexes are refered to, deadlock could occur by a subtle error. <strong>Monitors</strong> are provided by some programming languages to manage a group of mutual exclusive threads. </p>
<blockquote>
<p>Only one of the threads in this group would run in a certain time. It&#39;s up to the compiler to arrange mutexes to accomplish the monitor.</p>
</blockquote>
<h3>Message Passing</h3>
<p><strong>message passing</strong> is used for information exchange between machines. This method of interprocess communication uses 2 primitives, <code>send</code> and <code>receive</code>.</p>
<p>Approaches:</p>
<ol>
<li><p><strong>mailbox</strong> </p>
<p> A mailbox is a place to buffer a certian number of messages.</p>
</li>
<li><p><strong>rendezvous</strong></p>
<p> No buffering, either of each primitive is blocked until the other occurs.</p>
</li>
</ol>
<h3>Barriers</h3>
<p>With multiple processes, a <strong>barrier</strong> can be placed at the end of each phase. When a process reaches the barrier, it&#39;s blocked until all processes have reached the barrier.</p>
<h2>Scheduling</h2>
<h3>Introduction to Scheduling</h3>
<h4>Personal Computer</h4>
<p>Scheduling is simpler in personal computers because (1) there is only one active process, (2) CPU is more faster than I/O.</p>
<h4>Process Behavior</h4>
<p>Compute-bound: long CPU bursts and thus infrequent I/O waits.<br>I/O-bound: short CPU bursts and thus frequent I/O waits.</p>
<h4>When to Schedule</h4>
<ol>
<li>A new process is created</li>
<li>A process exits</li>
<li>A process blocks on I/O</li>
<li>I/O interrupt occurs</li>
</ol>
<p>Types of schedule algorithm</p>
<ol>
<li><strong>nonpreemptive</strong> scheduling algorithm: picks a process to run until it blocks, exit, or voluntarily release the CPU.</li>
<li><strong>preemptive</strong> scheduling algorithm: picks a process and lets it run for a maximum of some fixed time.</li>
</ol>
<h4>Goals of Scheduling Algorithms</h4>
<p>All systems</p>
<ul>
<li>Fainess - giving each process a fair share of the CPU</li>
<li>Policy enforcement - seeing that stated policy is carried out</li>
<li>Balance - keeping all parts of the system busy</li>
</ul>
<p>Batch systems</p>
<ul>
<li>Throughput - maximize jobs per hour</li>
<li>Turnaround tiem - minimize time between submission and termination</li>
<li>CPU utilization - keep the CPU busy all the time</li>
</ul>
<p>Interactive systems</p>
<ul>
<li>Response time - respond to requests quickly</li>
<li>Propertionality - meets user&#39;s expectations</li>
</ul>
<p>Real-time systems</p>
<ul>
<li>Meeting deadlines - avoid losing data</li>
<li>Predictability - avoid quality degradation in multimedia systems</li>
</ul>
<h3>Scheduling in Batch Systems</h3>
<h4>First-Come First-Served</h4>
<h4>Shortest Job First</h4>
<p>Reduce the mean turnaround time.</p>
<h4>Shortest Remaining Time Next</h4>
<p>When new process enterd, its executime is compared with the remaining time of current process.</p>
<h3>Scheduling in Interactive Systems</h3>
<h4>Round-Robin Scheduling</h4>
<p>Each process is assigned a time interval, called its <strong>quantum</strong> , during which it is allowed to run. The CPU switches when the process blocks, of course.</p>
<p>Setting the quantum too short causes too many process switches and lowers the CPU efficiency, but setting it too long may cause poor response to short interactive requests. A quantum arount 20-50 msec is often a resnable compromise.</p>
<h4>Priority Scheduling</h4>
<p>Each process is assigned a priority, and the runable process with the highest priority is allowed to run. The priority of the running process decreases at each clock tick.</p>
<blockquote>
<p>A simple algorithm for giving a good service to I/O bound processes is to set the priority to 1/f, where f is the fraction of the last quantum that a process used.</p>
</blockquote>
<h4>Multiple Queues</h4>
<p>Set up priority classes, a group of processes sorted by priority in each class. </p>
<p>Whenever a process used up all the quanta allocted to it, it was moved down one class, saving the CPU for short, interactive processes.</p>
<p>Whenever a carriage return was typed at a terminal, the process belonging to that terminal was moved to the highest priority class. </p>
<blockquote>
<p>This prevents a process that needed to run for a long time when it first started but became interactive later, from being punished forever.</p>
</blockquote>
<h4>Shorted Process Next</h4>
<p>To a certain extent, it would be nice if this algorithm used in batch systems could be used for interactive processes.</p>
<p><strong>aging</strong></p>
<p>Estimating running time as <span class="mathjax">\(t = aT_0 + (1-a)T_1\)</span></p>
<h4>Guaranteed Scheduling</h4>
<p>Make real promises to the users about performance ahd then live up to those promises.</p>
<ol>
<li>Compute the ratio of actual CPU time consumed to CPU time entitled.</li>
<li>Run the process with the lowest ratio until its ratio is no longer the lowest.</li>
</ol>
<h4>Lottery Scheduling</h4>
<p>Give processes lottery tickets for various system resources. Whenever a scheduling decision has to be made, a lottery ticket is chosen at random, and the process holding that ticket gets the resource.</p>
<p>Advantages</p>
<ol>
<li>lottery scheduling is highly responsive, the process have more lottery tickets is more likely to get the turn.</li>
<li>processes can exchange lottery tickets, the server and the client for example.</li>
</ol>
<h4>Fair-Share Scheduling</h4>
<p>Each user is allocated some fraction of the CPU and the scheduler picks processes in such a way to enforce it.</p>
<p>For example, user 1 created process A B C D, while user 2 only created process E, the scheduling sequence should be:</p>
<p>A E B E C E ...</p>
<p>If user 1 is entitled to twice as much CPU time as user 2, the sequence should be:</p>
<p>A B E C D E ...</p>
<h3>Scheduling in Real-Time Systems</h3>
<p>The events that a real-time system may have to respond to can be categorized as <strong>periodic</strong> (occurring at regular intevals) or <strong>aperiodic</strong> (occurring unpredictably).</p>
<p>Depending on how much time each event requires for processing, it may not even be possible to handle them all. A real-time system that meets this requirement is said to be <strong>schedulable</strong> .</p>
<h3>Policy versus Mechanism</h3>
<p>Separate the scheduling mechanism from the scheduling policy to alow more flexible scheduling. What this means is that the scheduling algorithm is parameterized in some way.</p>
<h3>Thread Scheduling</h3>
<p><img src="/assets/img/blog/thread-scheduling.png" alt="thread-scheduling"></p>
<ul>
<li>Kernel-level thread doesn&#39;t block the entire process when blocking sys-calls are made, unlike user-level thread.</li>
<li>Since the kernel knows that switching from a thread in process A to a thread in process B is more expensive than running a second thread in process A, it can take this into account when making a decision.</li>
<li>User-level threads can employ an application-specific thread scheduler.</li>
</ul>
<h1>Memory Management</h1>


    
      <style>
  /* JiaThis & Uyan bootstrap fix */
	.jiathis_style *, .jiathis_style,
  .jiathis_style_24x24 *, .jiathis_style_24x24{
      -webkit-box-sizing: content-box!important;
      -moz-box-sizing: content-box!important;
      box-sizing: content-box!important;
  }
  .jiathis_style_24x24{
          margin-top: 20px;
  }
</style>


<!-- JiaThis Button BEGIN -->
<div class="jiathis_style_24x24 pull-right">
	<a class="jiathis_button_fb"></a>
	<a class="jiathis_button_linkedin"></a>
	<a class="jiathis_button_googleplus"></a>
	<!--a class="jiathis_button_tsina"></a-->
	<a class="jiathis_button_weixin"></a>
	<!--a href="http://www.jiathis.com/share?uid=1851884" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a-->
	<!--a class="jiathis_counter_style"></a-->
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code_mini/jia.js?uid=1372495112151668" charset="utf-8"></script>
<!-- JiaThis Button END -->


<div class="clearfix"></div>
<hr/>


<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'harttleland'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
</div>


  </div>

</div>

      </div>
      
    </div>

    <div id="footer">
      <div class="container">
	<div class="credit nowrap">
	  <p class="text-muted" title="Copyright © 2013 Harttle. Hosted by GitHub and powered by Jekyll.">
	    Copyright © 2013 
	    <a href="//harttle.github.io">Harttle</a>. Hosted by
	    <a href="//github.com/" target="_blank">GitHub</a>
	    and powered by
	    <a href="//jekyllrb.com/">Jekyll</a>.
	    
	  </p>
	  <div class="pull-right hidden-xs follow">
	    <a href="https://www.facebook.com/harttle" target="_blank">
	      <i class="fa fa-facebook-square fa-lg"></i>
	    </a>
	    <a href="http://www.linkedin.com/profile/view?id=294339963" target="_blank">
	      <i class="fa fa-linkedin-square fa-lg"></i>
	    </a>
	    <a href="https://plus.google.com/113657098095399233141?rel=author" target="_blank">
	      <i class="fa fa-google-plus-square fa-lg"></i>
	    </a>
	  </div>	  
	</div>
      </div>
    </div>
<!-- content -->

<!-- script -->
    
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="//oss.maxcdn.com/libs/html5shiv/3.6.2/html5shiv.js"></script>
      <script src="//v3.bootcss.com/docs-assets/js/respond.min.js"></script>
    <![endif]-->
    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
    <script src="/assets/jquery/jquery.scrollUp.min.js"></script>
    <script src="/assets/jquery/jquery.lazyload.min.js" type="text/javascript"></script>
    
    <!-- Bootstrap -->
    <script src="/assets/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    
    
    


<script>
  $(function(){    
    var toc = getTOC($('.post-display .right'));
    if (toc != null) {
      $('.sidebar').append(toc);
      
      //sidebar affix, this offset is for sidebar position recognition
      setTimeout(function () {
          var $sideBar = $('.sidebar')
          $sideBar.affix({
              offset: {                
                  top: function () {                    
                      var offsetTop      = $sideBar.offset().top;
                      var sideBarMargin  = parseInt($sideBar.children(0).css('margin-top'), 10);
                      sideBarMargin     += parseInt($('#page-content').css('margin-top'), 10);
                      return (this.top = offsetTop - navHeight - sideBarMargin);
                  },
                  bottom: function(){
                    var sideBarMargin  = parseInt($sideBar.children(0).css('margin-bottom'), 10);
                    return (this.bottom = footHeight + sideBarMargin);
                  }
              }
          });
      },100);
      
      //sidebar scroll spy
      $('body').scrollspy({
        target: '.sidebar',
        offset: navHeight + 10  //make sure to spy the element when scrolled to
      }); 
    }
    else{
      $('.post-display .right').removeClass('col-md-9');
      $('.post-display').removeClass('row-fluid');
      $('.post-display .left').remove();
    }
  });
  
  //生成目录
  function getTOC($content) {    
    var $toc = $('<ul class="nav level-0" >').addClass("nav sidenav");

    var base_level = 1;
    while ($content.find('h' + base_level).length < 1 && base_level < 7) base_level += 1;
    if (base_level == 7) return null;
    
    $content.find(':header').each(function (i) {
      var $this = $(this);
      $this.attr('id', i);
      
      var level = parseInt(this.nodeName.substr(1));
      var offset = level - base_level;
      
      var li = new $('<li/>')
          .append('<a href="#' + i + '" class="animate">' + $this.text() + '</a>')
          .append($('<ul class="nav level-'+(offset+1)+'"/>'));
      
      $('<div>').append($toc).find('ul.level-'+offset+':last').append(li);
    });
    return $toc;
  }
</script>

<!-- latex render begin -->
<script type="text/x-mathjax-config">  
  MathJax.Hub.Queue(function () {
    //update scrollspy
    $('body').scrollspy('refresh');
  });
</script>
<script>
  $(function(){
    $('.md .mathjax').each(function (i, v) {
        //MathJax.Hub.Queue(["Typeset", MathJax.Hub, v]);
    })
  })
</script>
<!--script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG"></script-->
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<!-- latex render end -->



    
    <script>
      var navHeight = 50;
      var footHeight = $('#footer').outerHeight(true);
      $(function(){
	
        //更新菜单
        $('.nav #blog').attr('class','active');
        
        //激活工具提示
        $('[data-toggle="tooltip"]').tooltip();
        
        //图片延迟加载
        $("img.lazy").lazyload({effect : "fadeIn", skip_invisible : false});	//bootstrap thumbnail img will be invisible at the begining
        
        //回到顶部按钮
        $.scrollUp({
	  scrollName: 'scrollUp',topDistance: '300',topSpeed: 300,animation: 'fade',animationInSpeed: 500,
	  animationOutSpeed: 500,scrollText: '',activeOverlay: false,
	});	
        
        //页面内链接滑动效果
        $body = (window.opera) ? (document.compatMode == "CSS1Compat" ? $('html') : $('body')) : $('html,body');
        $('a.animate').click(function(){
          var offset = navHeight;
          if ($(this).attr('offset')) {
            offset += parseInt($(this).attr('offset')); 
          }
          $body.animate({scrollTop: $($(this).attr('href')).offset().top - offset}, 500);
          return false;
        });        
      });
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-45491170-1', 'harttle.github.io');
      ga('send', 'pageview');
    </script>
<!-- script -->

  </body>
</html>
