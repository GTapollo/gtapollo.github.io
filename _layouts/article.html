---
layout: post
nav: blog
returl: "/blog.html"
---

<link rel="stylesheet" href="/assets/css/markdown.css">

<style>
#post-toc{
  background:#f5f5f5;
  padding:15px;
}
#post-toc .header{
  margin:0;
}
#post-toc .content>ol{
  margin: 10px 0 0 0;
}
#post-toc ul, #post-toc li{
  margin-top:5px;
}
#post-content{
  margin-top:15px;
}
</style>

<div id="post-toc"></div>

<div id="post-content" class="md">
  {{ content }}
</div>

<script>
  $(function(){
    //添加目录
    $('#post-toc').html(genTOC($('#post-content')));
    
    //目录折叠
    $('#toc_icon').click(function(){
      $('#post-toc .content').toggle(400);
      $(this).toggleClass('glyphicon-chevron-up glyphicon-chevron-down');
    });
  })
  
  //生成目录
  function genTOC($content) {
    var toc = $('<ol/>');
    var ul = '';

    var fi = 1;
    while ($content.find('h' + fi).length < 1 && fi < 7) fi += 1;
    if (fi == 7) return "";
    
    var c = ['H' + fi,'H' + (fi+1),'H' + (fi+2)];
    $content.find('h' + fi + ',h' + (fi + 1) + ',h' + (fi + 2)).each(function (i) {
      var $this = $(this);
      $this.attr('id', i);
      if (this.nodeName == c[0]) {
        var li = new $('<li/>')
          .append('<a href="#' + i + '" offset="100" class="animate">' + $this.text() + '</a>')
          .append($('<ul/>'));
        toc.append(li);
      }
      else if(this.nodeName == c[1]){
        var li = new $('<li/>')
          .append('<a href="#' + i + '" offset="100" class="animate">' + $this.text() + '</a>')
          .append($('<ul/>'));
        toc.find('a[href="#'+$this.prevAll(c[0]).first().attr('id')+'"]')
                 .next('ul').append(li);
      }
      else{ 
        var li = new $('<li/>')
          .append('<a href="#' + i + '" offset="100" class="animate">' + $this.text() + '</a>')
          .append($('<ul/>'));
        toc.find('a[href="#'+$this.prevAll(c[1]).first().attr('id')+'"]')
                 .next('ul').append(li);
      }
    });
    return '<h4 class="header" style="display:inline;">目录</h4>'
      + '<span id="toc_icon" class="glyphicon glyphicon-chevron-up" style="margin-left:5px;cursor:pointer;"></span>'
      + '<div class="content">' + toc[0].outerHTML + '</div>';
  }
</script>
